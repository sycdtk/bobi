# 流程引擎概述
## 一、说明
	此流程引擎，仅作为mofy工程的流程引擎支持，会包含很多高耦合的开发实现，不考虑做成为一个支持各场景工作流的的通用框架。
	
	此流程引擎参考了一些现有流程引擎的概念和定义，加入了一些自己理解功能和元素，不具有工作流的标准规范的通用性。
	流程引擎设计结构主要分为两大部分：定义部分和运行部分。
	
	+ 1）定义部分
	定义部分用以设计、保存流程定义所需的要素，包含：流程定义、节点、连线、关联关系、规则、任务。

	+ 2）运行部分
	运行部分主要是流程运行过程中，形成流程定义部分对应的实例对象，与定义部分基本对应。包含：流程实例、节点实例、任务实例、Token（流程实例待执行节点）。

## 二、引擎介绍
	以下章节将针对流程引擎设计的思路和重要逻辑进行简要介绍。

### 1、流程定义
	流程定义用以记录一个完成的流程，包含流程的开始节点、任务节点、结束节点、节点与节点之间的连线、连线上的条件规则、节点的出向和入向规则等。目前的流程支持：顺序、分支、并行流程、子流程。


### 2、节点

	节点用以定义流程中的单个任务，主要记录：节点出向和入向的规则、节点来源和去向的连接关系、节点所需执行的任务。
	
	节点有以下类型：
	+ 开始节点：所有的流程都是以此节点做为流程入口。节点只有出向关系，没有入向关系。
	+ 结束节点：所有的流程都是以此节点做为流程结束。节点只有入向关系，没有出向关系。
	+ 用户任务节点（默认）：流程的通用任务节点，用以与实际的节点业务逻辑进行关联。
	+ 自动任务节点：流程执行过程中，自动执行的任务节点，进入后自动触发执行规则，执行完成后，提交至下一任务节点。（TODO：同步、异步执行）
	+ 子流程节点：流程与流程之间的调用节点，通过子流程节点，能够调用其他已经定义的流程节点。
	
	节点出向、入向规则包含：
	+ 排他（默认）
	+ 并行
	+ 包含

	
### 3、连线
AAA

### 4、关联关系


### 5、规则

### 6、任务

### 7、Token

### 8、流程实例

### 9、节点实例

### 10、任务实例

## 三、引擎功能


## 四、代码介绍



//两个节点单一方向上的连线，有且仅有一条
//节点支持指向自身




//节点类型：
//网关说明：http://www.mossle.com/docs/activiti/index.html#bpmnCustomExtensions
//排他网关（也叫异或（XOR）网关，或更技术性的叫法 基于数据的排他网关）， 用来在流程中实现决策。
//  当流程执行到这个网关，所有外出顺序流都会被处理一遍。 其中条件解析为true的顺序流（或者没有设置条件，概念上在顺序流上定义了一个'true'）
//  会被选中，让流程继续运行。注意这里的外出顺序流 与BPMN 2.0通常的概念是不同的。通常情况下，所有条件结果为true的顺序流 都会被选中，
//  以并行方式执行，但排他网关只会选择一条顺序流执行。 就是说，虽然多个顺序流的条件结果为true，
//  那么XML中的第一个顺序流（也只有这一条）会被选中，并用来继续运行流程。 如果没有选中任何顺序流，会抛出一个异常。
//并行网关：网关也可以表示流程中的并行情况。最简单的并行网关是 并行网关，它允许将流程 分成多条分支，也可以把多条分支 汇聚到一起。 of execution.
//  并行网关的功能是基于进入和外出的顺序流的：
//    分支： 并行后的所有外出顺序流，为每个顺序流都创建一个并发分支。
//    汇聚： 所有到达并行网关，在此等待的进入分支， 直到所有进入顺序流的分支都到达以后， 流程就会通过汇聚网关。
//  注意，如果同一个并行网关有多个进入和多个外出顺序流， 它就同时具有分支和汇聚功能。 这时，网关会先汇聚所有进入的顺序流，然后再切分成多个并行分支。
//  与其他网关的主要区别是，并行网关不会解析条件。 即使顺序流中定义了条件，也会被忽略。
//包含网关:可以看做是排他网关和并行网关的结合体。 和排他网关一样，你可以在外出顺序流上定义条件，包含网关会解析它们。 但是主要的区别是包含网关可以选择多于一条顺序流，这和并行网关一样。
//  包含网关的功能是基于进入和外出顺序流的：
//    分支： 所有外出顺序流的条件都会被解析，结果为true的顺序流会以并行方式继续执行， 会为每个顺序流创建一个分支。
//    汇聚： 所有并行分支到达包含网关，会进入等待章台， 直到每个包含流程token的进入顺序流的分支都到达。 这是与并行网关的最大不同。换句话说，包含网关只会等待被选中执行了的进入顺序流。 在汇聚之后，流程会穿过包含网关继续执行。
//  注意，如果同一个包含节点拥有多个进入和外出顺序流， 它就会同时含有分支和汇聚功能。 这时，网关会先汇聚所有拥有流程token的进入顺序流， 再根据条件判断结果为true的外出顺序流，为它们生成多条并行分支。



//规则包含Rule内部逻辑结果、连线关系逻辑结果、节点规则逻辑结果，最终节点逻辑结果决定了流程是否进行流转至下一步
//1、Rule内部逻辑包含传入数据比对、与非逻辑等
//2、连线关系逻辑、节点规则逻辑仅包含 AND、OR、NOT之间的与非逻辑
//逻辑关系：AND/OR/NOT
//字符串：等于、不等于、包含、不包含
//数值：大于、小于、等于、大于等于、小于等于、不等于